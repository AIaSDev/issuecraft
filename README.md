# IssueCraft

A minimal **FastAPI** issue tracker demonstrating **Clean Architecture** with **SQLite** (development & CI) and **PostgreSQL** (production) support.

---

## What is this?

**IssueCraft** is a small REST API for managing issues (a very small subset of GitHub Issues).  
It is designed for **educational purposes** and focuses on:

- Clean Architecture terminology and layering
- Clear separation of concerns
- Testability (unit tests + integration tests)
- Minimal configuration and tooling

---

## Architecture Overview

The project follows **Clean Architecture** with dependencies pointing inward.

```
src/app/
├── core/                      # Configuration and database setup
│   ├── config.py              # Environment-based configuration
│   └── database.py            # SQLAlchemy engine, session, Base
├── entities/                  # Pure domain entities
│   └── issue.py               # Issue entity with validation
├── use_cases/                 # Application services (use cases)
│   └── issue_service.py       # IssueService
├── interfaces/
│   ├── controllers/           # HTTP layer (FastAPI routers)
│   │   └── issue_api.py
│   └── gateways/              # Repository interfaces (ports)
│       └── issue_repository.py
├── frameworks/
│   ├── web/                   # FastAPI application wiring
│   │   └── app.py
│   └── persistence/           # Database implementations
│       ├── models.py          # SQLAlchemy ORM models
│       └── sqlalchemy_repository.py
└── main.py                    # Application entry point
```

### Dependency Rule

- **Entities** and **use cases** do not depend on FastAPI or SQLAlchemy
- **Interfaces** define boundaries (ports)
- **Frameworks** implement technical details (web, database)

---

## API Endpoints

- `POST /issues` – Create an issue (title required, body optional)
- `GET /issues` – List all issues
- `GET /issues/{issue_id}` – Get a specific issue
- `GET /health` – Health check

---

## Running Locally

### Prerequisites

- Python 3.11+
- pip

### Installation

```bash
pip install -r requirements.txt
```

### Run the Application

By default, the application uses **file-based SQLite** (`app.db`):

```bash
export PYTHONPATH=$PWD/src
uvicorn app.main:app --reload
```

Open:
- API docs: http://localhost:8000/docs
- Health check: http://localhost:8000/health

---

## Running Tests

### Unit Tests

Unit tests do not use FastAPI or SQLAlchemy and rely on a fake in-memory repository.

```bash
export PYTHONPATH=$PWD/src
pytest -q tests/unit
```

### Integration Tests

Integration tests use FastAPI `TestClient` and an in-memory SQLite database.

```bash
export PYTHONPATH=$PWD/src
export DATABASE_URL=sqlite:///:memory:
pytest -q tests/integration
```

---

## Running with Docker

```bash
docker build -t issuecraft .
docker run -p 8000:8000 issuecraft
```

To run with PostgreSQL:

```bash
docker run -p 8000:8000 \
  -e DATABASE_URL=postgresql+psycopg://user:password@host:5432/database \
  issuecraft
```

---

## Releases and Packages

This repository uses **tag-based releases**:

- GitHub Releases are created automatically when a tag `vX.Y.Z` is pushed
- Release notes (changelog) are generated automatically by GitHub
- Docker images are published to **GitHub Container Registry (GHCR)**

### Create a Release

```bash
git tag v0.1.0
git push origin v0.1.0
```

This will:
- Create a GitHub Release with autogenerated notes
- Publish Docker images:
  - `ghcr.io/<owner>/<repo>:v0.1.0`
  - `ghcr.io/<owner>/<repo>:latest`

---

## License

This project is intended for **educational use**.